#include <iostream>
#include <fstream>
#include <random>
#include <cstdlib>
#include "Genome.hpp"

using namespace SAHap;
using namespace std;

int main(int argc, char *argv[]) {
	if (argc < 2 || argc > 4) {
		cerr << "Usage: " << argv[0] << " <reads> [gt] [millions of iterations = 10]" << endl;
		return 1;
	}

	ifstream file;
	file.open(argv[1]);
	auto parsed = WIFInputReader::read(file, 2);

	if (argc > 3) {
		ifstream gtruth;
		gtruth.open(argv[2]);

		WIFInputReader::readGroundTruth(gtruth, parsed);
	}

	iteration_t iterations = argc == 4 ? atoi(argv[3]) * META_ITER : atoi(argv[2]) * META_ITER;
	
	try {
		Genome ge(parsed);
		ge.autoSchedule(iterations);
			try {
				ge.optimize(true);
				cout << ge;
			} catch (const char * e) {
				cerr << e << endl;
			}
		// }

		/*
		// cout << ge.haplotypes[0].percentAgree() << endl;
		for (float e = -5; e <= 2; e += 0.1) {
			float temp = pow(10, e);
			auto pbad = ge.findPbad(temp);
			cout << temp << " " << pbad << endl;
		}
		*/

	} catch (const char* e) {
		cout << e << endl;
	}

	// ge.optimize();

	// /*
	// for (float e = -10; e <= 10; ++e) {
	// 	float temp = pow(10, e);
	// 	cout << temp << ": " << ge.findPbad(temp) << endl;
	// }
	// */
	// /*
	// for (float i = 1; i > 0; i -= 0.1f) {
	// 	cout << "pBad @ " << i << " = " << ge.findPbad(100) << endl;
	// }
	// */

	/*
	12103311031220000123230023022220212001001332121300223323122231313100013220132331210333013232002002013322332113030101101312022101130212223110011132032312102003331230202312323203021220012012010032133303031320113202202102123022121023120212201203312100032003213321023010012113113220033120033022031201323130132020010200213223321131303231301133100123322003312231001130300110102223032203320200331302020221111323321032333103330100333123220312102131222201030121322233333110310330132320000003122121301311110021
	12103311031220000123230023022220212001001332121300223323122231313100013220132331210333013232002002013322332113030101101312022101130212223110011132032312102003331230202312323203021220012012010032133303031320113202202102123022121023120212201203312100032003213321023010012113113220033120033022031201323130132020010200213223321131303231301133100123322003312231001130300110102223032203320200331302020221111323321032333103330100333123220312102131222201030121322233333110310330132320000003122121301311110003

	10032200320113333012123312311113101330330221010233112212011120202033302113021220103222302121331331302211221002323030030201311030023101112003300021321201031332220123131201212132310113301301303321022232320213002131131031012311010312013101130132201033321332102210312303301002002113322013322311320130212023021313303133102112210020232120230022033012211332201120330023233003031112321132213133220231313110000212210321222032223033222012113201031020111130323010211122222003203223021213333332011010230200003331
	01032200320113333012123312311113101330330221010233112212011120202033302113021220103222302121331331302211221002323030030201311030023101112003300021321201031332220123131201212132310113301301303321022232320213002131131031012311010312013101130132201033321332102210312303301002002113322013322311320130212023021313303133102112210020232120230022033012211332201120330023233003031112321132213133220231313110000212210321222032223033222012113201031020111130323010211122222003203223021213333332011010230200003332

	10321133213002222301012201200002030223223110303122001101300013131322231002310113032111231010220220231100110331212323323130200323312030001332233310210130320221113012020130101021203002230230232210311121213102331020020320301200303201302030023021130322210221031103201232230331331002211302211200213023101312310202232022031001103313121013123311322301100221130013223312122332320001210021102022113120202003333101103210111321112322111301002130320313000023212303100011111332132112310102222221300303123133332221
	30321133213002222301012201200002030223223110303122001101300013131322231002310113032111231010220220231100110331212323323130200323312030001332233310210130320221113012020130101021203002230230232210311121213102331020020320301200303201302030023021130322210221031103201232230331331002211302211200213023101312310202232022031001103313121013123311322301100221130013223312122332320001210021102022113120202003333101103210111321112322111301002130320313000023212303100011111332132112310102222221300303123133332221
	*/

	return 0;
}

